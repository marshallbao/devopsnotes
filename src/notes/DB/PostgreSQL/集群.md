# 集群

###  Patroni 高可用（HA）方案：可用性概述

Patroni 是一个基于 **etcd** 或 **Consul** 等一致性存储系统的 PostgreSQL 高可用性管理工具。它的目的是通过提供自动故障转移和自动恢复功能来确保 PostgreSQL 的高可用性。

#### 工作原理

Patroni 通过将 PostgreSQL 集群的主节点（Master）与备份节点（Standby）进行管理，提供自动故障转移和恢复机制。当主节点发生故障时，Patroni 会自动将其中一个备用节点提升为新的主节点，以保证系统的可用性。

- 分布式协调：Patroni 使用外部一致性存储（如 etcd、Consul）来存储集群状态信息。所有节点通过这个存储系统进行协调，保证集群内只有一个主节点。
- 自动故障转移：在主节点发生故障时，Patroni 会自动检测并将一个备用节点提升为主节点。这个过程通常是无缝的，确保系统最小的停机时间。
- 同步复制和异步复制：Patroni 支持同步复制和异步复制。同步复制可以提供更强的数据一致性保障，而异步复制可以提高性能。



### Citus 分布式方案：大数据量

#### 概述

Citus 是一个基于 PostgreSQL 的分布式数据库扩展，它通过将数据库分割成多个节点（分片）来实现水平扩展。Citus 的核心目标是让 PostgreSQL 能够处理更大规模的工作负载和更高的吞吐量。

#### 工作原理

Citus 通过将表分片并分布在多个节点上，实现数据的 **水平分片（sharding）**。数据会根据某个字段（例如用户 ID 或时间戳）进行划分，每个分片由一个 PostgreSQL 节点管理。查询会自动路由到相关的分片上，并返回结果。

- 分片（Sharding）：Citus 将表按照某个键（例如，用户 ID）进行水平切分，将数据分布在多个节点上。
- 分布式查询：Citus 可以在多个节点之间并行执行查询，提升查询性能。它将复杂的查询拆分成多个子查询，并将其分发到各个分片上并行执行，然后合并结果。
- 扩展性：Citus 可以通过增加更多节点来水平扩展 PostgreSQL 集群。
- 故障恢复：Citus 支持自动数据恢复，但不具备强一致性的跨节点事务管理，它的设计更多关注性能和可扩展性。