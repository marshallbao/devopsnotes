### RabbitMQ 模式

RabbitMQ 通过普通集群模式、镜像集群模式以及仲裁队列来实现高可用

普通集群模式

- 在集群的各个节点间共享部分数据，包括：交换机、队列元信息。但不包含队列中的消息。
- 当访问集群某节点时，如果队列不在该节点，会从数据所在节点传递到当前节点并返回
- 队列所在节点如果宕机，队列中的消息就会丢失，因此普通集群只是提高了并发能力，并未实现高可用

镜像集群模式

在镜像集群模式下，你创建的`queue`，无论元数据还是`queue`里的消息都会存在于多个实例上，就是说，每个 `RabbitMQ`节点都有这个`queue`的一个完整镜像，包含 `queue` 的全部数据的意思。然后每次你写消息到`queue`的时候，都会自动把消息同步到多个实例的`queue`上。

缺点

1、性能消耗太大，所有机器都要进行消息的同步，导致网络压力和消耗很大。

2、没有扩展性可言，如果有一个queue负载很重，就算加了机器，新增的机器还是包含了这个queue的所有数据，并没有办法扩展queue。



仲裁队列

RabbitMQ 的 3.8 版本以后，推出了新的功能：使用仲裁队列来代替镜像集群，底层采用 Raft 协议确保主从的数

据一致性。

虽然请求仍然都是由主节点进行操作，然后同步到从节点中。但是对于任何节点来说，既可能是某个仲裁队列的主

节点，也可能是其它仲裁队列的从节点。因此也具有分散节点压力，提高并发访问的特点。另外如果主节点挂了，

其中的某个从节点就会变成主节点，并在其它节点上尽可能创建出新的主节点，保障主从数量一致。



### 参考

https://blog.csdn.net/weixin_42039228/article/details/123520355

https://blog.csdn.net/yygEwing/article/details/116329666

https://www.cnblogs.com/studyjobs/p/17744247.html