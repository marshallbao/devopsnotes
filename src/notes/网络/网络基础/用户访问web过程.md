用户访问 WEB 服务的完整过程


1、客户端在浏览器中输入要访问的域名地址，如：www.baidu.com


2、浏览器请求解析DNS服务器，把域名www.baidu.com转换成web服务器的IP地址。


1）系统首先会查找本地的DNS缓存和hosts文件信息，确认其中是否有与，域名www.baidu.com所对应的IP地址。如果有，就直接访问这个IP地址所对应的www.baidu.com域名服务器。


2）如果没有找到，那么，系统将会把浏览器的解析请求发送给本地主机所指定的DNS服务器，称为LDNS。如果LDNS服务器中有域名www.baidu.com所对应的IP地址，则返回给客户端的浏览器，如果没有，则继续请求其他DNS服务器。


3）LDNS服务器会从DNS系统的根（.）开始请求对域名www.baidu.com的解析。根DNS服务器全球只有13台，根域名服务器是没有域名www.baidu.com解析记录的。但是它会有域名www.baidu.com所对应的顶级域.com的解析记录，因此直接把顶级域.com所对应的DNS地址返回给LDNS服务器。


4）LDNS服务器获取到顶级域.com对应的DNS服务器地址后，就会去.com服务器请求对www.baidu.com域名的解析。在顶级域名服务器也不会有www.baidu.com的解析记录的。但是它有www.baidu.com的父级域名，即baidu.com。因此顶级域名.com服务器又会把baidu.com所对应的DNS服务器的IP地址返回给LDNS。


5）LDNS服务器收到baidu.com所对应的IP地址后，就会去baidu.com域名服务器请求对www.baidu.com的域名解析。Baidu.com域名对应的DNS服务器是该域名的授权DNS服务器。这个DNS服务器就是企业购买域名时用于管理解析的服务器。


6）baidu.com域名DNS服务器会吧www.baidu.com域名所对应的IP地址给解析出来，然后发给LDNS。


7）LDNS把解析出来的结果，www.baudu.com所对应的IP地址发送给客户端的浏览器。并且LDNS也会将其域名和对应的地址缓存到cache中。


8）客户端浏览器收到后，也会将其域名以及对应的IP地址缓存的到DNS缓存和hosts文件中。





3、浏览器从访问的IP地址（URL）解析出默认的断后号：80


4、浏览器通过解析后得到的IP地址和端口号进行web服务器建立一条TCP连接通道。


1）第一次握手：


建立连接时，客户端A发送SYN包（SYN=j）到服务器B，并进入SYN_SEND状态，等待服务器B确认。


2）第二次握手：


服务器B收到SYN包，必须确认客户A的SYN（ACK=j+1），同时自己也发送一个SYN包（SYN=k），即SYN+ACK包，此时服务器B进入SYN_RECV状态。


3）第三次握手：


客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK（ACK=k+1），此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。





5、建立TCP连接之后，浏览器向web服务器发送一条HTTP请求报文。


1）请求行


作用：用来说明客户端想要做什么。


内容：包括方法字段GET和URL字段以及HTTP协议版本


2）请求头


作用：通过客户端把请求的相关信息发给服务器


内容：包括媒体类型、语言类型、支持压缩、客户端类型、主机等信息。


3）空行


作用：告诉服务器空行以下内容不属于请求头部信息。


4）请求报文主体


作用：用来说明客户端具体想要做的事情。


内容：查看信息、应用post方法。


6、web服务器响应并读取浏览器的请求信息，然后返回一条HTTP响应报文。


1）状态行


作用：用来说明服务端响应客户端的状态。


内容：包括洗衣及版本号、数字状态码、状态情况


2）响应头


作用：通过服务端把响应的相关信息给客户端


内容：包括Location、server、connect、vary等


3）空行


作用：告诉客户端空行以下内容不属于响应头部信息。


4）响应报文主体


作用：用来装载着要返回给客户端的数据


内容：包括文本、html、视频或者是图片。


7、web服务器关闭HTTP连接，关闭TCP连接，web服务器显示访问的网站内容到屏幕上。


1）第一次挥手：


客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 


2）第二次挥手：


服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 


3）第三次挥手：


服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 


4）第四次挥手：


客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。