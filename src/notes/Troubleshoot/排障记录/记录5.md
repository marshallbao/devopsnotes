环境： gke

故障背景：
前一天晚上主网浏览器发布了新版本，早上上班之后收到开发反馈，主网浏览器反应非常慢，几乎是不可用的状态于是进行排查

排查步骤：
1、直接从后端容器请求后端接口很慢，排除掉是前端问题，推论是后端导致的
1、然后请求后端的接口都需要进行数据库查询，所以怀疑是后端请求数据的问题，但是直接访问数据库随机查询了一些东西反应都很快
2、使用db.currentOp() 查看正在执行的 sql 也没有耗时比较长的 sql 
3、于是僵住了，开发通过日志看到有其他应用在请求后端，随把其他应用停止掉，也没有缓解
4、于是进行后端代码回滚，也没有解决
5、然后其他同事使用 mongotop 命令发现有sync_tx 集合读需要几十秒的时间，发现了问题的一层原因，但是什么请求导致的呢？
6、通过停止后端的定时任务和前端服务，进行排查，发现停止掉前端服务后，数据库读就正常了，说明问题来自于前端的请求
7、但是前端请求都是正常的，于是怀疑是有人恶意请求或者其他原因，于是将域名重定向到错误的地方，使用ip 进行访问发现，果然恢复了
8、然后通过ingress控制器日志 grep 前端的svc,查看有哪些ip在请求，果然发现一个ip 在一直以不正常的方式请求浏览器，所以判断是这个ip的恶意请求 导致的
9、于是通过ingress 的注释，把这个 ip 加入了黑名单，域名切换到正确的 svc 服务终于恢复正常。



经验：
1、访问慢可以通过某个具体的接口来确认是哪一层的问题，是电脑访问前端慢？还是前端访问后端慢？还是后端访问数据库慢，都可以通过一层一层进行排查
2、对于查看mongo 数据库状态还是太自信了 认为只通过 db.currenOP 就可以看明白，如果怀疑某个方向有问题，一定要用多个命令，多种方式，多个方法来确定，是不是真的没问题（mongotop ,mongostat）
3、遇到没有处理过的问题不要慌，要独立思考下，看下如何解决