### 密钥生成

RSA：RSA加密算法是一种非对称加密算法

DSA：Digital Signature Algorithm (DSA)是Schnorr和ElGamal签名算法的变种

#### ssh-keygen

```
ssh-keygen -t rsa -C "yonggui" -f ~/.ssh/test/crm-git
 
-t 表示密钥的类型 ，默认为 RSA
-b 表示密钥的长度，默认为 2048
-f 表示密钥文件的名字,默认为 /root/.ssh/id_rsa
-C 用于识别这个密钥的注释 
```



### 登录认证过程

主机认证，一次就可以了，就是第一次链接主机提示 yes/no

用户认证，有密钥、密码等多种认证方式；

公钥登录

客户端在家目录的 .ssh 目录下生成密钥对，将公钥发送至服务端用户的家目录的 .ssh 目录下，cat id_rsa.pub >>~/.ssh/authorized_keys

私钥登录

服务端生成密钥对，将私钥发送至客户端，cat id_rsa >> ~/.ssh/id_rsa(或者是重命名私钥文件为id_rsa-nyancat-gke，然后在客户端的 ssh_config 中声明 IdentityFile ~/.ssh/id_rsa-nyancat-gke)

通过公钥或者私钥进行登录要根据实际环境进行考量（在sshd_config中将passwd认证设置为no）；







### SSH 转发

1、本地端口转发

本地转发将本地主机上的一个端口转发到远程服务器的一个指定地址和端口

2、远程端口转发

远程转发将远程服务器上的一个端口转发到本地主机的一个指定地址和端口

3、动态端口转发

动态转发创建了一个本地 SOCKS 代理服务器，将所有的网络流量通过 SSH 隧道转发到远程服务器，并由远程服务器代理发送出去。这种方式可以让你通过远程服务器安全地浏览互联网，也被称为 SSH 动态端口转发或 SSH SOCKS 代理。

#### 详细说明

场景&前提：A1 机器只能通过 ssh（22 端口）登录 B1 机器
A0、A 网络下的客户端机器
A1、A 网络下的操作机器
A2、A 网络下的另一台机器

B1、B 网络下的一台机器（可以只能被 A1 通过 22 端口登录）
B2、B 网络下的一台机器

```
# 本地端口转发
-L [bind_address:]port:host:hostport

示例
ssh -gfNL 10.0.4.49:80:10.133.38.191:80 root@41.11.192.186 -o ServerAliveInterval=15 -o ServerAliveCountMax=180

A1:10.0.4.49
B1:41.11.192.186
B2:10.133.38.191
解析：将 10.133.38.191 监听的 80 端口，通过 41.11.192.186 转发到 10.0.4.49 的 80
效果：访问 10.0.4.49:80 ---> 10.133.38.191:80

# 远程端口转发
-R
示例
ssh -fNR :80:10.0.4.40:80 root@41.11.192.186 -o ServerAliveInterval=15 -o ServerAliveCountMax=180

A2:10.0.4.40
B1:41.11.192.186
解析：将在 41.11.192.186 机器的任意网口启动 80 端口，然后将流量转到 10.0.4.40 监听的 80 端口
效果：访问 41.11.192.186:80 ---> 10.0.4.40:80

# 参数说明
-N 参数告诉 SSH 不要执行任何远程命令。这通常用于只建立 SSH 连接而不需要实际执行命令的场景
-g 参数允许其他主机通过本地主机的转发端口访问远程服务器上转发的服务。如果不加该参数，则默认情况下只能通过本地主机自身来访问转发的服务
-f 参数将 SSH 会话放到后台运行，以便你可以继续使用终端窗口进行其他操作，而无需保持 SSH 会话的前台运行
```







SSH 通过代理登录

```
ssh -o "ProxyCommand nc -X 5 -x 127.0.0.1:7890 %h %p" iris@35.229.237.99

ssh -o ProxyCommand='nc -x <代理服务器IP地址>:<代理端口> -S <代理服务器用户名>:<代理服务器密码> %h %p' user@host
```

